<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flash Fingers - Typing Game</title>
    
    <!-- Favicon -->
    <link rel="icon" href="logo/LOGO.png" type="image/png">
    
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            text-align: center;
            background: linear-gradient(135deg, #1e1e2e, #2a2a3d);
            color: #ffffff;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            box-sizing: border-box;
            position: relative;
        }

        h1 {
            font-size: clamp(32px, 8vw, 48px);
            margin: 15px 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            color: #00ffcc;
            letter-spacing: 2px;
        }

        #gameLogo {
            width: clamp(120px, 40vw, 180px);
            height: auto;
            margin-bottom: 10px;
            filter: drop-shadow(0 0 15px #00ffcc);
            transition: transform 0.4s ease;
        }

        #gameLogo:hover {
            transform: scale(1.1) rotate(2deg);
        }

        /* Desktop Icons */
        #desktopIcons {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 15px;
            z-index: 10;
        }

        #desktopIcons span {
            font-size: 28px;
            cursor: pointer;
            color: #ffffff;
            transition: transform 0.3s, color 0.3s;
            padding: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }

        #desktopIcons span:hover {
            color: #00ffcc;
            transform: scale(1.2);
        }

        #homeIcon {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 28px;
            cursor: pointer;
            color: #ffffff;
            transition: transform 0.3s, color 0.3s;
            padding: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            z-index: 10;
        }

        #homeIcon:hover {
            color: #00ffcc;
            transform: scale(1.2);
        }

        /* Mobile Hamburger Menu */
        #mobileMenuBtn {
            position: absolute;
            top: 15px;
            left: 15px;
            font-size: 32px;
            cursor: pointer;
            color: #ffffff;
            padding: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            z-index: 20;
            display: none;
        }

        #mobileMenu {
            position: absolute;
            top: 70px;
            left: 15px;
            background: rgba(40, 42, 54, 0.95);
            border-radius: 15px;
            padding: 15px;
            display: none;
            flex-direction: column;
            gap: 15px;
            z-index: 15;
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
            backdrop-filter: blur(10px);
            border: 1px solid #00ffcc;
        }

        #mobileMenu span {
            font-size: 26px;
            cursor: pointer;
            padding: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }

        #mobileMenu span:hover {
            background: rgba(0, 255, 204, 0.2);
            transform: scale(1.1);
        }

        #display {
            font-size: clamp(20px, 5vw, 28px);
            margin: 20px auto;
            background: rgba(40, 42, 54, 0.9);
            padding: 15px 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            max-width: 95vw;
            width: 100%;
            backdrop-filter: blur(5px);
            word-wrap: break-word;
            line-height: 1.6;
            box-sizing: border-box;
            display: none;
        }

        #typingBox {
            font-size: clamp(22px, 5.5vw, 26px);
            margin: 20px auto;
            padding: 15px;
            border: 3px solid #00ffcc;
            width: 90vw;
            max-width: 600px;
            height: 80px;
            text-align: left;
            background: rgba(51, 51, 51, 0.8);
            border-radius: 12px;
            color: #ffffff;
            box-shadow: 0 0 15px rgba(0, 255, 204, 0.3);
            transition: border-color 0.3s;
            resize: none;
            overflow: hidden;
            box-sizing: border-box;
            display: none;
            caret-color: #00ffcc;
        }

        #typingBox:focus {
            outline: none;
            border-color: #00ccff;
        }

        .green-text { color: #00ff00; text-shadow: 0 0 5px rgba(0,255,0,0.5); }
        .red-text { color: #ff4444; text-shadow: 0 0 5px rgba(255,68,68,0.5); }
        .space-error {
            position: relative;
            display: inline-block;
            width: 10px;
        }
        .space-error::after {
            content: "";
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 3px;
            background: #ff4444;
            box-shadow: 0 0 8px rgba(255, 68, 68, 0.8);
            border-radius: 2px;
        }

        #statusIndicator {
            width: clamp(100px, 30vw, 130px);
            height: 40px;
            background: linear-gradient(45deg, #ff4444, #ff6666);
            margin: 15px auto;
            border-radius: 20px;
            line-height: 40px;
            font-size: clamp(18px, 5vw, 20px);
            font-weight: bold;
            box-shadow: 0 2px 10px rgba(255,68,68,0.3);
            transition: all 0.3s;
            opacity: 0;
        }

        #statusIndicator.active { opacity: 1; }
        #statusIndicator.green {
            background: linear-gradient(45deg, #4caf50, #66bb6a);
            box-shadow: 0 2px 10px rgba(76,175,80,0.3);
        }

        #startButton, #restartButton, #downloadResultBtn {
            padding: 12px 30px;
            font-size: clamp(18px, 5vw, 22px);
            margin: 10px;
            cursor: pointer;
            border: none;
            border-radius: 25px;
            background: linear-gradient(45deg, #4caf50, #66bb6a);
            color: white;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }

        #startButton:hover, #restartButton:hover, #downloadResultBtn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.6);
        }

        #resultButtons {
            display: none;
            flex-direction: column;
            width: 90%;
            max-width: 400px;
            gap: 15px;
            margin: 20px auto;
        }

        #stats, #highScore, #message {
            font-size: clamp(16px, 4.5vw, 20px);
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-width: 90vw;
            width: 100%;
            box-sizing: border-box;
        }

        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(40, 42, 54, 0.98);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            width: 95%;
            max-width: 550px;
            max-height: 90vh;
            overflow-y: auto;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border: 1px solid #00ffcc;
        }

        .modal-header {
            font-size: clamp(24px, 7vw, 28px);
            margin-bottom: 20px;
            color: #00ffcc;
            text-shadow: 0 0 10px #00ffcc;
        }

        #resultText {
            background: rgba(0,0,0,0.4);
            padding: 15px;
            border-radius: 15px;
            font-size: clamp(14px, 4vw, 17px);
            line-height: 2;
            margin: 20px 0;
            text-align: left;
            border: 1px dashed #00ffcc;
            color: #ffffff;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
        }

        .download-btn, .copy-btn {
            width: 90%;
            max-width: 350px;
            padding: 12px;
            font-size: clamp(16px, 4.5vw, 20px);
            margin: 10px auto;
            display: block;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            color: white;
        }

        .download-btn { background: linear-gradient(45deg, #0088ff, #00ccff); box-shadow: 0 4px 15px rgba(0, 136, 255, 0.4); }
        .copy-btn { background: linear-gradient(45deg, #ff6b6b, #ff8787); }

        .download-btn:hover, .copy-btn:hover { transform: translateY(-3px); }

        #toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #00ff88;
            color: black;
            padding: 15px 30px;
            border-radius: 50px;
            font-weight: bold;
            z-index: 2000;
            display: none;
            box-shadow: 0 5px 15px rgba(0,255,0,0.3);
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 30px;
            color: #ff4444;
            cursor: pointer;
        }

        .modal-close:hover { color: #ff6666; }

        .modal-content { display: none; font-size: clamp(15px, 4vw, 16px); text-align: left; color: #ffffff; }
        .modal-content.active { display: block; }

        .modal-buttons { display: flex; justify-content: space-around; flex-wrap: wrap; gap: 10px; }
        .modal-button {
            padding: 10px 20px;
            font-size: 18px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            min-width: 100px;
        }

        #soundOnButton.green, #soundOffButton.green {
            background: linear-gradient(45deg, #4caf50, #66bb6a);
            color: white;
        }

        #soundOnButton.grey, #soundOffButton.grey {
            background: linear-gradient(45deg, #666, #999);
            color: white;
        }

        #yesButton, #noButton {
            background: linear-gradient(45deg, #4caf50, #66bb6a);
            color: white;
        }

        .modal-button:hover { transform: translateY(-2px); }

        @media (min-width: 768px) {
            #resultButtons { flex-direction: row; justify-content: center; }
            #mobileMenuBtn, #mobileMenu { display: none !important; }
        }

        @media (max-width: 767px) {
            #desktopIcons, #homeIcon { display: none; }
            #mobileMenuBtn { display: block; }
            body { padding-top: 70px; }
        }
    </style>
</head>
<body>
    <!-- Mobile Menu -->
    <div id="mobileMenuBtn">‚ò∞</div>
    <div id="mobileMenu">
        <span id="mobileSoundIcon">üîä</span>
        <span id="mobileResetIcon">‚öôÔ∏è</span>
        <span id="mobileAboutIcon">‚ÑπÔ∏è</span>
        <span id="mobileHomeIcon">üè†</span>
    </div>

    <!-- Desktop Icons -->
    <div id="desktopIcons">
        <span id="soundIcon">üîä</span>
        <span id="resetIcon">‚öôÔ∏è</span>
        <span id="aboutIcon">‚ÑπÔ∏è</span>
    </div>
    <span id="homeIcon">üè†</span>

    <img src="logo/LOGO.png" alt="Flash Fingers Logo" id="gameLogo">
    <h1>Flash Fingers - Typing Game</h1>

    <button id="startButton">Start</button>
    <div id="statusIndicator">0.00</div>
    <div id="display"></div>
    <textarea id="typingBox"></textarea>
    <div id="stats"></div>
    <div id="highScore">High Score: <span id="highScoreValue"></span> üèÜ</div>
    <div id="message"></div>

    <div id="resultButtons">
        <button id="downloadResultBtn">üì• Download Result</button>
        <button id="restartButton">Restart</button>
    </div>

    <!-- Result Modal -->
    <div id="resultModal" class="modal">
        <span class="modal-close" id="resultModalClose">‚úñ</span>
        <div class="modal-header">üèÜ Your Typing Result</div>
        <pre id="resultText">Loading...</pre>
        <button class="download-btn" id="modalDownloadBtn">üíæ Download Result</button>
        <button class="copy-btn" id="copyResultBtn">üìã Copy Result</button>
    </div>

    <div id="toast">Result copied to clipboard! ‚úÖ</div>

    <!-- Sound Modal -->
    <div id="soundModal" class="modal">
        <span id="soundModalClose" class="modal-close">‚úñ</span>
        <div class="modal-header">Sound Settings</div>
        <div class="modal-buttons">
            <button id="soundOnButton" class="modal-button">ON</button>
            <button id="soundOffButton" class="modal-button">OFF</button>
        </div>
    </div>

    <!-- Reset Modal -->
    <div id="resetModal" class="modal">
        <span id="resetModalClose" class="modal-close">‚úñ</span>
        <div class="modal-header">Do you want to reset high score?</div>
        <div class="modal-buttons">
            <button id="yesButton" class="modal-button">Yes</button>
            <button id="noButton" class="modal-button">No</button>
        </div>
    </div>

    <!-- About Modal -->
    <div id="aboutModal" class="modal">
        <span id="aboutModalClose" class="modal-close">‚úñ</span>
        <div class="modal-header" id="howToPlayHeader">How to Play</div>
        <div class="modal-header" id="aboutGameHeader">About Game</div>
        <div class="modal-header" id="aboutCreatorHeader">About Creator</div>
        <div class="modal-header" id="contactHeader">Contact Info</div>
        <div id="howToPlayContent" class="modal-content active">
            <p>1. Press <strong>Enter</strong> or click "Start" to begin.<br>
            2. A random sentence will appear ‚Äî get ready!<br>
            3. <strong>Timer starts when you type the first letter</strong> (and that letter counts!)<br>
            4. Type accurately and press Enter to finish.<br>
            5. See your Time, WPM, Accuracy, and more!<br>
            6. Press <strong>Enter</strong> again or click Restart for next round.<br>
            <strong>New:</strong> Multiple sentences + WPM + Space mistake visible!</p>
        </div>
        <div id="aboutGameContent" class="modal-content">
            <p>This game helps improve typing speed and accuracy with random sentences, WPM tracking, and a sleek design.</p>
        </div>
        <div id="aboutCreatorContent" class="modal-content">
            <p>Developed by Elia Haider from Baltistan, Pakistan.</p>
        </div>
        <div id="contactContent" class="modal-content">
            <p>Email: <a href="mailto:haiderhashmi1120@gmail.com">haiderhashmi1120@gmail.com</a><br>
            YouTube: <a href="https://www.youtube.com/channel/UCAaSY7QKjtxdsIphuZEcO-g" target="_blank">Elia Haider's Channel</a></p>
        </div>
    </div>

    <!-- Audio -->
    <audio id="buttonSound" src="sounds/button.mp3"></audio>
    <audio id="wrongSound" src="sounds/wong.mp3"></audio>
    <audio id="highScoreSound" src="sounds/high score.mp3"></audio>
    <audio id="bg1Sound" src="sounds/bg1.mp3" loop></audio>
    <audio id="bg2Sound" src="sounds/bg2.mp3" loop></audio>
    <audio id="typeSound" src="sounds/type.mp3"></audio>
    <audio id="enterSound" src="sounds/enter.mp3"></audio>
    <audio id="startSound" src="sounds/start.mp3"></audio>

    <script>
        const sentences = [
            "The quick brown fox jumps over the lazy dog.",
            "Pack my box with five dozen liquor jugs.",
            "The five boxing wizards jump quickly.",
            "How vexingly quick daft zebras jump!",
            "Bright vixens jump; dozy fowl quack.",
            "Sphinx of black quartz, judge my vow.",
            "Two driven jocks help fax my big quiz.",
            "Jinxed wizards pluck ivy from the big quilt.",
            "Crazy Fredrick bought many very exquisite opal jewels.",
            "Jived fox nymph grabs quick waltz.",
            "Glib jocks quiz nymph to vex dwarf.",
            "Blowzy red vixens fight for a quick jump.",
            "Joaquin Phoenix was gazed by MTV for luck.",
            "Waxy and quivering, jocks fumble the pizza.",
            "The jay, pig, fox, zebra and my wolves quack!"
        ];

        let currentSentence = "";
        let userInput = "";
        let startTime = null;
        let mistakeIndices = new Set();
        let highScore = localStorage.getItem("highScore") ? parseFloat(localStorage.getItem("highScore")) : null;
        let gameReady = false;
        let gameInProgress = false;
        let gameFinished = false;
        let timerInterval = null;
        let lastResultText = "";

        const display = document.getElementById("display");
        const typingBox = document.getElementById("typingBox");
        const stats = document.getElementById("stats");
        const highScoreValue = document.getElementById("highScoreValue");
        const startButton = document.getElementById("startButton");
        const restartButton = document.getElementById("restartButton");
        const statusIndicator = document.getElementById("statusIndicator");
        const message = document.getElementById("message");
        const resultButtons = document.getElementById("resultButtons");
        const downloadResultBtn = document.getElementById("downloadResultBtn");

        const buttonSound = document.getElementById("buttonSound");
        const wrongSound = document.getElementById("wrongSound");
        const highScoreSound = document.getElementById("highScoreSound");
        const bg1Sound = document.getElementById("bg1Sound");
        const bg2Sound = document.getElementById("bg2Sound");
        const typeSound = document.getElementById("typeSound");
        const enterSound = document.getElementById("enterSound");
        const startSound = document.getElementById("startSound");

        const soundModal = document.getElementById("soundModal");
        const soundModalClose = document.getElementById("soundModalClose");
        const soundOnButton = document.getElementById("soundOnButton");
        const soundOffButton = document.getElementById("soundOffButton");
        const resetModal = document.getElementById("resetModal");
        const resetModalClose = document.getElementById("resetModalClose");
        const yesButton = document.getElementById("yesButton");
        const noButton = document.getElementById("noButton");
        const aboutModal = document.getElementById("aboutModal");
        const aboutModalClose = document.getElementById("aboutModalClose");
        const howToPlayHeader = document.getElementById("howToPlayHeader");
        const aboutGameHeader = document.getElementById("aboutGameHeader");
        const aboutCreatorHeader = document.getElementById("aboutCreatorHeader");
        const contactHeader = document.getElementById("contactHeader");
        const howToPlayContent = document.getElementById("howToPlayContent");
        const aboutGameContent = document.getElementById("aboutGameContent");
        const aboutCreatorContent = document.getElementById("aboutCreatorContent");
        const contactContent = document.getElementById("contactContent");

        const soundIcon = document.getElementById("soundIcon");
        const resetIcon = document.getElementById("resetIcon");
        const aboutIcon = document.getElementById("aboutIcon");
        const homeIcon = document.getElementById("homeIcon");

        const mobileMenuBtn = document.getElementById("mobileMenuBtn");
        const mobileMenu = document.getElementById("mobileMenu");
        const mobileSoundIcon = document.getElementById("mobileSoundIcon");
        const mobileResetIcon = document.getElementById("mobileResetIcon");
        const mobileAboutIcon = document.getElementById("mobileAboutIcon");
        const mobileHomeIcon = document.getElementById("mobileHomeIcon");

        const resultModal = document.getElementById("resultModal");
        const resultModalClose = document.getElementById("resultModalClose");
        const resultText = document.getElementById("resultText");
        const modalDownloadBtn = document.getElementById("modalDownloadBtn");
        const copyResultBtn = document.getElementById("copyResultBtn");
        const toast = document.getElementById("toast");

        let soundEnabled = localStorage.getItem("soundEnabled") !== "false";
        if (soundEnabled) bg2Sound.play();

        function playSound(audio) {
            if (soundEnabled) {
                audio.currentTime = 0;
                audio.play().catch(() => {});
            }
        }

        function updateSoundButtons() {
            soundOnButton.className = "modal-button " + (soundEnabled ? "green" : "grey");
            soundOffButton.className = "modal-button " + (!soundEnabled ? "green" : "grey");
        }
        updateSoundButtons();

        function showAboutSection(section) {
            howToPlayContent.classList.remove("active");
            aboutGameContent.classList.remove("active");
            aboutCreatorContent.classList.remove("active");
            contactContent.classList.remove("active");
            section.classList.add("active");
        }

        function getRandomSentence() {
            return sentences[Math.floor(Math.random() * sentences.length)];
        }

        function updateDisplay() {
            display.innerHTML = "";
            for (let i = 0; i < currentSentence.length; i++) {
                const char = currentSentence[i];
                const span = document.createElement("span");
                if (i < userInput.length) {
                    if (userInput[i] === char) {
                        span.className = "green-text";
                    } else {
                        if (char === " ") span.className = "space-error";
                        else span.className = "red-text";
                        mistakeIndices.add(i);
                    }
                } else {
                    span.style.color = "white";
                }
                span.textContent = char === " " ? "\u00A0" : char;
                display.appendChild(span);
            }
            typingBox.value = userInput;
        }

        function prepareGame() {
            currentSentence = getRandomSentence();
            userInput = "";
            mistakeIndices.clear();
            startTime = null;
            gameReady = true;
            gameInProgress = false;
            gameFinished = false;

            statusIndicator.classList.remove("active", "green");
            statusIndicator.textContent = "0.00";

            updateDisplay();
            display.style.display = "block";
            typingBox.style.display = "block";
            typingBox.value = "";
            resultButtons.style.display = "none";
            stats.innerHTML = "";
            message.innerHTML = "";
            highScoreValue.innerText = highScore ? highScore.toFixed(2) + " sec" : "No record yet";
            startButton.style.display = "none";
            if (soundEnabled) { bg2Sound.pause(); bg1Sound.play(); }
            typingBox.focus();
        }

        function startTimer() {
            gameInProgress = true;
            statusIndicator.classList.add("active", "green");
            startTime = new Date();
            playSound(startSound);
            timerInterval = setInterval(() => {
                const elapsed = (new Date() - startTime) / 1000;
                statusIndicator.textContent = elapsed.toFixed(2);
            }, 10);
        }

        function finishGame() {
            playSound(enterSound);
            const endTime = new Date();
            const actualTime = (endTime - startTime) / 1000;
            const correctChars = currentSentence.length - mistakeIndices.size;
            const grossWPM = Math.round((currentSentence.length / 5) / (actualTime / 60)) || 0;
            const penalty = mistakeIndices.size * 0.5;
            const totalTime = actualTime + penalty;
            const netWPM = Math.round((correctChars / 5) / (actualTime / 60)) || 0;
            const accuracy = ((correctChars / currentSentence.length) * 100).toFixed(1);

            lastResultText = `üèÜ FLASH FINGERS - TYPING RESULT üèÜ

üìù Sentence: "${currentSentence}"

‚è±  Time Taken: ${actualTime.toFixed(2)} seconds
üèÉ Raw WPM: ${grossWPM}
üéØ Adjusted WPM: ${netWPM}
‚è∞ Penalty: ${penalty.toFixed(2)} sec (${mistakeIndices.size} mistakes √ó 0.5s)
‚ùå Mistakes: ${mistakeIndices.size}
üéØ Accuracy: ${accuracy}%

${accuracy >= 90 && (!highScore || totalTime < highScore) ? "üèÜ NEW HIGH SCORE BROKEN! üèÜ" : "High Score: " + (highScore ? highScore.toFixed(2) + " sec" : "No record yet")}

Developed by Elia Haider
Play again at: ${window.location.href}`;

            stats.innerHTML = `
                ‚è± Time Taken: ${actualTime.toFixed(2)} sec<br>
                üèÉ Raw WPM: ${grossWPM}<br>
                üéØ Adjusted WPM: ${netWPM}<br>
                ‚è∞ Penalty: ${penalty.toFixed(2)} sec<br>
                ‚ùå Mistakes: ${mistakeIndices.size}<br>
                üéØ Accuracy: ${accuracy}%
            `;

            if (accuracy >= 90 && (!highScore || totalTime < highScore)) {
                highScore = totalTime;
                localStorage.setItem("highScore", highScore);
                message.innerHTML = "<span style='color:#00ff00; font-size:24px;'>üèÜ High Score Broken! üèÜ</span>";
                playSound(highScoreSound);
                setTimeout(() => message.innerHTML = "", 3000);
            }

            highScoreValue.innerText = highScore ? highScore.toFixed(2) + " sec" : "No record yet";

            resultButtons.style.display = "flex";

            statusIndicator.classList.remove("active", "green");
            clearInterval(timerInterval);
            timerInterval = null;

            if (soundEnabled) { bg1Sound.pause(); bg2Sound.play(); }
            gameFinished = true;
            gameInProgress = false;
            gameReady = false;
        }

        // Typing Logic - Prevent duplicate + Mobile keyboard
        document.addEventListener("keydown", function(e) {
            if (gameInProgress || gameReady || gameFinished) {
                e.preventDefault(); // Prevent browser from adding character
            }

            if (startButton.style.display !== "none" && e.key === "Enter") {
                playSound(buttonSound);
                prepareGame();
                return;
            }

            if (gameReady && !gameInProgress && !gameFinished && e.key.length === 1) {
                startTimer();
                userInput += e.key;
                if (e.key !== currentSentence[0]) {
                    mistakeIndices.add(0);
                    playSound(wrongSound);
                } else {
                    playSound(typeSound);
                }
                updateDisplay();
                return;
            }

            if (gameInProgress && !gameFinished) {
                if (e.key === "Backspace" && userInput.length > 0) {
                    userInput = userInput.slice(0, -1);
                    mistakeIndices.delete(userInput.length);
                    playSound(enterSound);
                    updateDisplay();
                    return;
                }

                if (e.key === "Enter" && userInput.length === currentSentence.length) {
                    finishGame();
                    return;
                }

                if (e.key.length === 1 && userInput.length < currentSentence.length) {
                    userInput += e.key;
                    if (e.key !== currentSentence[userInput.length - 1]) {
                        mistakeIndices.add(userInput.length - 1);
                        playSound(wrongSound);
                    } else {
                        playSound(typeSound);
                    }
                    updateDisplay();
                }
            }

            if (gameFinished && e.key === "Enter") {
                playSound(buttonSound);
                prepareGame();
            }
        });

        // Mobile tap to focus
        typingBox.addEventListener("touchstart", (e) => {
            typingBox.focus();
        });
        typingBox.addEventListener("click", () => {
            typingBox.focus();
        });

        // Buttons & Icons
        startButton.addEventListener("click", () => { playSound(buttonSound); prepareGame(); });
        restartButton.addEventListener("click", () => { playSound(buttonSound); prepareGame(); });

        downloadResultBtn.addEventListener("click", () => {
            resultText.textContent = lastResultText;
            resultModal.style.display = "block";
            playSound(buttonSound);
        });

        resultModalClose.addEventListener("click", () => {
            resultModal.style.display = "none";
            playSound(buttonSound);
        });

        modalDownloadBtn.addEventListener("click", () => {
            const blob = new Blob([lastResultText], { type: "text/plain" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "flashfingers_result.txt";
            a.click();
            URL.revokeObjectURL(url);
            playSound(buttonSound);
        });

        copyResultBtn.addEventListener("click", () => {
            navigator.clipboard.writeText(lastResultText).then(() => {
                toast.style.display = "block";
                setTimeout(() => toast.style.display = "none", 3000);
                playSound(buttonSound);
            });
        });

        // Mobile Menu
        mobileMenuBtn.addEventListener("click", () => {
            playSound(buttonSound);
            mobileMenu.style.display = mobileMenu.style.display === "flex" ? "none" : "flex";
        });

        mobileSoundIcon.addEventListener("click", () => {
            playSound(buttonSound);
            soundModal.style.display = "block";
            mobileMenu.style.display = "none";
        });

        mobileResetIcon.addEventListener("click", () => {
            playSound(buttonSound);
            resetModal.style.display = "block";
            mobileMenu.style.display = "none";
        });

        mobileAboutIcon.addEventListener("click", () => {
            playSound(buttonSound);
            aboutModal.style.display = "block";
            showAboutSection(howToPlayContent);
            mobileMenu.style.display = "none";
        });

        mobileHomeIcon.addEventListener("click", () => {
            playSound(buttonSound);
            location.reload();
        });

        // Desktop Icons
        soundIcon.addEventListener("click", () => { playSound(buttonSound); soundModal.style.display = "block"; });
        resetIcon.addEventListener("click", () => { playSound(buttonSound); resetModal.style.display = "block"; });
        aboutIcon.addEventListener("click", () => { playSound(buttonSound); aboutModal.style.display = "block"; showAboutSection(howToPlayContent); });
        homeIcon.addEventListener("click", () => { playSound(buttonSound); location.reload(); });

        // Modal Close & Buttons
        soundModalClose.addEventListener("click", () => { playSound(buttonSound); soundModal.style.display = "none"; });
        resetModalClose.addEventListener("click", () => { playSound(buttonSound); resetModal.style.display = "none"; });
        aboutModalClose.addEventListener("click", () => { playSound(buttonSound); aboutModal.style.display = "none"; });

        soundOnButton.addEventListener("click", () => {
            soundEnabled = true;
            localStorage.setItem("soundEnabled", "true");
            updateSoundButtons();
            soundModal.style.display = "none";
            playSound(buttonSound);
            bg2Sound.play();
        });

        soundOffButton.addEventListener("click", () => {
            soundEnabled = false;
            localStorage.setItem("soundEnabled", "false");
            bg1Sound.pause();
            bg2Sound.pause();
            updateSoundButtons();
            soundModal.style.display = "none";
            playSound(buttonSound);
        });

        yesButton.addEventListener("click", () => {
            localStorage.removeItem("highScore");
            highScore = null;
            highScoreValue.innerText = "No record yet";
            resetModal.style.display = "none";
            playSound(buttonSound);
        });

        noButton.addEventListener("click", () => {
            resetModal.style.display = "none";
            playSound(buttonSound);
        });

        howToPlayHeader.addEventListener("click", () => { playSound(buttonSound); showAboutSection(howToPlayContent); });
        aboutGameHeader.addEventListener("click", () => { playSound(buttonSound); showAboutSection(aboutGameContent); });
        aboutCreatorHeader.addEventListener("click", () => { playSound(buttonSound); showAboutSection(aboutCreatorContent); });
        contactHeader.addEventListener("click", () => { playSound(buttonSound); showAboutSection(contactContent); });
    </script>
</body>
</html>
